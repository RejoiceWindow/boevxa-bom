import U from"./fs-uploader.1660443802877.js";import{B as w}from"./index.1660443802877.js";import{r as k,f as C,a8 as d,j as r,k as a,l as _,V as m,W as b,I as N,ab as R,Z as f,T as S,a1 as u,_ as h,R as F}from"./vue.1660443802877.js";import"./index2.1660443802877.js";const I={name:"FsCropperUploader",components:{FsUploader:U},props:{disabled:{},modelValue:{type:[String,Array]},img:{},type:{type:String},uploadTip:{type:String},title:String,cropperHeight:{type:[String,Number]},dialogWidth:{type:[String,Number],default:"50%"},maxSize:{type:Number,default:5},limit:{type:Number,default:1},accept:{type:String,default:".jpg, .jpeg, .png, .gif, .webp"},cropper:{type:Object},uploader:{type:Object},buildUrl:{type:Function,default:function(e,i){return typeof e=="object"?i.url:e}}},emits:["update:modelValue","change"],setup(){return{cropperRef:k()}},data(){return{index:void 0,list:[]}},computed:{_urlList(){const e=[];if(this.list)for(const i of this.list)e.push(i.url);return e}},watch:{modelValue(e){this.$emit("change",e),e!==this.emitValue&&this.initValue(e)}},created(){this.emitValue=this.modelValue,this.initValue(this.modelValue)},methods:{initValue(e){const i=[];if(e==null||e===""){this.list=i;return}if(typeof e=="string")i.push({url:this.buildUrl(e),value:e,status:"done"});else for(const t of e)i.push({url:this.buildUrl(t),value:t,status:"done"});this.list=i},addNewImage(){this.disabled||(this.index=void 0,this.cropperRef.clear(),this.cropperRef.open())},removeImage(e){this.list.splice(e,1),this.emit()},hasUploading(){const e=this.list;if(e&&e.length>0){for(const i of e)if(i.status==="uploading")return!0}return!1},async cropComplete(e){const i=e.blob,t=e.dataUrl,g=e.file,o=C({url:void 0,dataUrl:t,status:"uploading",progress:0}),n=s=>{o.progress=s.percent},c=s=>{o.status="error",o.message="\u6587\u4EF6\u4E0A\u4F20\u51FA\u9519:"+s.message,console.error(s)},p={file:i,fileName:g.name,onProgress:n,onError:c};this.list.push(o);try{const s=await this.doUpload(p);o.url=this.buildUrl(s.url),o.value=s.url,o.status="done",this.emit()}catch(s){c(s)}},async doUpload(e){var i;e.options=this.uploader;let t=(i=this.$refs.uploaderImplRef)==null?void 0:i.getUploaderRef();if(t==null)throw new Error("Sorry\uFF0CThe component is not ready yet");return await(t==null?void 0:t.upload(e))},emit(){const e=[];for(const t of this.list)typeof t=="string"?e.push(t):e.push(t.value);let i=e;this.limit===1&&(i=e&&e.length>0?e[0]:void 0),this.emitValue=i,this.$emit("update:modelValue",i)}}},j={class:"image-list"},z={class:"image-slot"},B={key:0,class:"delete"},E={key:1,class:"status-uploading"},L={key:2,class:"status-done"};function T(e,i,t,g,o,n){var c;const p=d("fs-loading"),s=d("fs-icon"),v=d("fs-cropper"),V=d("fs-uploader");return r(),a("div",{class:F(["fs-cropper-uploader",{"is-disabled":t.disabled}])},[_("div",j,[(r(),m(f(e.$fsui.imageGroup.name),null,{default:b(()=>[(r(!0),a(N,null,R(o.list,(l,y)=>(r(),a("div",{key:y,class:"image-item"},[(r(),m(f(e.$fsui.image.name),S({class:"image",src:l.dataUrl?l.dataUrl:l.url},t.img),{placeholder:b(()=>[_("div",z,[u(p,{loading:!0})])]),_:2},1040,["src"])),t.disabled?h("",!0):(r(),a("div",B,[u(s,{icon:e.$fsui.icons.remove,onClick:x=>n.removeImage(y,l)},null,8,["icon","onClick"])])),l.status==="uploading"?(r(),a("div",E,[(r(),m(f(e.$fsui.progress.name),{type:"circle",percentage:l.progress,width:70},null,8,["percentage"]))])):l.status==="done"?(r(),a("div",L,[u(s,{icon:e.$fsui.icons.check,class:"status-down-icon"},null,8,["icon"])])):h("",!0)]))),128)),t.limit<=0||t.limit>o.list.length?(r(),a("div",{key:0,class:"image-item image-plus",onClick:i[0]||(i[0]=(...l)=>n.addNewImage&&n.addNewImage(...l))},[u(s,{icon:e.$fsui.icons.plus,class:"cropper-uploader-icon"},null,8,["icon"])])):h("",!0)]),_:1}))]),u(v,{ref:"cropperRef",title:t.title,"cropper-height":t.cropperHeight,"dialog-width":t.dialogWidth,accept:t.accept,"upload-tip":t.uploadTip,"max-size":t.maxSize,cropper:t.cropper,output:"all",onDone:n.cropComplete},null,8,["title","cropper-height","dialog-width","accept","upload-tip","max-size","cropper","onDone"]),u(V,{ref:"uploaderImplRef",type:(c=t.uploader)==null?void 0:c.type},null,8,["type"])],2)}var O=w(I,[["render",T]]);export{O as default};
