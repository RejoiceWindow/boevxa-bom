import{r as d,_ as w,b as B,n as v,j as D}from"./index.1660443802877.js";import{G as L}from"./index.16604438028777.js";import{P as O,r as N,f as Y,w as _,y as P,t as S,k as V,a1 as a,W as o,a8 as m,j as b,$ as s,a0 as i,V as Q,_ as j}from"./vue.1660443802877.js";const F="/api/system/exit/";function W(e){return d({url:F,method:"get",params:e})}function H(e){return d({url:F+"0/sync_exit/",method:"get",params:e})}function J(e){return d({url:"/api/system/operate_exit/",method:"post",data:e})}function E(e){return d({url:"/api/system/operate_out/",method:"post",data:e})}function K(e){return d({url:F,method:"post",data:e})}function X(e){return d({url:F+e.id+"/",method:"put",data:e})}function Z(e){return d({url:F+e+"/",method:"delete",data:{id:e}})}const G=O({name:"TrayInfo",props:{outData:{type:Object,default:()=>{}},exitData:{type:Object,default:()=>{}}},setup(e){const f=N(),{t:u}=B(),t=Y({form:{FBillNo:"",FDate:"",FCustomerID:"",FMaterialId:"",FMaterialName:"",binCode:"",FStockID:"",FPrice:"",FLot:"",exitQty:"",FBinQty:-1,exitDate:"",FBinQtyMsg:"",exit:0,material:0,location:0},rules:{exitQty:{required:!0,message:u("app.operatePlaceholder.exitQty"),trigger:"blur"}}}),I=async r=>{!r||await r.validate(n=>{if(n){const p=e.outData;p.exitQty=t.form.exitQty,p.exitDate=t.form.exitDate,E(p).then(g=>{const y=g.data;y&&y.id?(D({showClose:!0,message:u("message.success.exit"),center:!0,type:"success"}),l()):D({showClose:!0,message:u("message.error.exit"),center:!0,type:"error"})})}})},$=r=>{!r||(t.form.exitQty="")},l=async()=>{e.exitData&&(t.form.FBillNo=e.exitData.FBillNo,t.form.FLot=e.exitData.FLot),e.outData&&(t.form.FPrice=e.outData.FPrice,t.form.FDate=e.outData.FDate,t.form.exit=e.outData.id,t.form.material=e.outData.material,t.form.location=e.outData.location);try{t.form.material>0&&t.form.location>0&&await L({material:t.form.material,location:t.form.location,limit:20,page:1}).then(r=>{const n=r.data.data[0];n&&n.id&&(parseFloat(n.FQty)<0&&D({showClose:!0,message:u("message.warning.warehouseQt"),center:!0,type:"warning"}),t.form.binCode=n.binCode,t.form.FStockID=n.FStockID,t.form.FCustomerID=n.FCustomerID,t.form.FMaterialId=n.FMaterialId,t.form.FMaterialName=n.FMaterialName,t.form.FLot=n.FLot,t.form.FBinQty=parseFloat(n.FQty),t.form.exitQty=e.outData.exitQty)})}catch(r){console.log("OperateExit",r)}};return _(()=>e.exitData,()=>{l()}),_(()=>e.outData,()=>{l()}),_(()=>t.form.exitQty,()=>{t.form.FBinQty<0?t.form.FBinQtyMsg=u("message.warning.warehouseQt"):parseFloat(t.form.exitQty)>t.form.FBinQty&&D({showClose:!0,message:u("app.operateInfo.countOver"),center:!0,type:"error"})}),P(()=>{t.form.exitDate=v(new Date,"YYYY-mm-dd")}),{exitInfoRef:f,formSubmit:I,resetForm:$,initForm:l,...S(t)}}}),R={class:"form-rules-one-container"};function z(e,f,u,t,I,$){const l=m("el-tag"),r=m("el-form-item"),n=m("el-divider"),p=m("el-date-picker"),g=m("el-input"),y=m("el-tooltip"),x=m("success-filled"),h=m("el-icon"),M=m("el-button"),C=m("refresh-left"),k=m("el-form");return b(),V("div",R,[a(k,{model:e.form,rules:e.rules,ref:"exitInfoRef",size:"default",class:"mt35"},{default:o(()=>[a(r,{label:e.$t("app.material.FMaterialId"),prop:"FMaterialId"},{default:o(()=>[a(l,null,{default:o(()=>[s(i(e.form.FMaterialId),1)]),_:1})]),_:1},8,["label"]),a(r,{label:e.$t("app.material.FMaterialName"),prop:"FMaterialName"},{default:o(()=>[a(l,null,{default:o(()=>[s(i(e.form.FMaterialName),1)]),_:1})]),_:1},8,["label"]),a(r,{label:e.$t("app.exit.FCustomerID"),prop:"FCustomerID"},{default:o(()=>[a(l,null,{default:o(()=>[s(i(e.form.FCustomerID),1)]),_:1})]),_:1},8,["label"]),a(r,{label:e.$t("app.warehouse.FLot"),prop:"FLot"},{default:o(()=>[a(l,null,{default:o(()=>[s(i(e.form.FLot),1)]),_:1})]),_:1},8,["label"]),a(r,{label:e.$t("app.exit.FPrice"),prop:"FPrice"},{default:o(()=>[a(l,null,{default:o(()=>[s(i(e.form.FPrice),1)]),_:1})]),_:1},8,["label"]),a(r,{label:e.$t("app.exit.FDate"),prop:"FDate"},{default:o(()=>[a(l,null,{default:o(()=>[s(i(e.form.FDate),1)]),_:1})]),_:1},8,["label"]),a(n),a(r,{label:e.$t("app.exit.exitDate"),prop:"exitDate"},{default:o(()=>[a(p,{modelValue:e.form.exitDate,"onUpdate:modelValue":f[0]||(f[0]=c=>e.form.exitDate=c),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:e.$t("app.exit.exitDate")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("app.operateLabel.exitQty"),prop:"exitQty"},{default:o(()=>[a(g,{modelValue:e.form.exitQty,"onUpdate:modelValue":f[1]||(f[1]=c=>e.form.exitQty=c),modelModifiers:{number:!0},type:"number",min:0,placeholder:e.$t("app.operatePlaceholder.exitQty"),clearable:"",step:1,autocomplete:"off"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(l,null,{default:o(()=>[s(i(e.$t("app.operateLabel.FBinQty"))+" "+i("  : "),1)]),_:1}),e.form.FBinQty>0?(b(),Q(l,{key:0,type:"success"},{default:o(()=>[s(i(e.form.FBinQty),1)]),_:1})):(b(),Q(y,{key:1,class:"box-item",effect:"dark",content:e.$t("message.warning.warehouseQtTip"),placement:"right-end"},{default:o(()=>[e.form.FBinQty<0?(b(),Q(l,{key:0,type:"warning"},{default:o(()=>[s(i(e.form.FBinQtyMsg)+i(" : ")+i(e.form.FBinQty),1)]),_:1})):j("",!0)]),_:1},8,["content"])),a(r,{label:e.$t("app.operateLabel.position"),prop:"FStockID"},{default:o(()=>[a(l,{size:"large",class:"mx-1",effect:"dark",round:""},{default:o(()=>[s(i(e.form.FStockID),1)]),_:1}),a(l,{size:"large",class:"mx-1",type:"danger",effect:"dark",round:""},{default:o(()=>[s(i(e.form.binCode),1)]),_:1})]),_:1},8,["label"]),a(n),a(r,null,{default:o(()=>[a(M,{type:"primary",onClick:f[2]||(f[2]=c=>e.formSubmit(e.exitInfoRef))},{default:o(()=>[a(h,null,{default:o(()=>[a(x)]),_:1}),s(i(e.$t("message.button.submit")),1)]),_:1}),a(M,{onClick:f[3]||(f[3]=c=>e.resetForm(e.exitInfoRef))},{default:o(()=>[a(h,null,{default:o(()=>[a(C)]),_:1}),s(i(e.$t("message.button.reset")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])])}var T=w(G,[["render",z]]),ee=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"}));export{K as A,Z as D,T as E,W as G,J as O,X as U,H as a,ee as b};
