import{r as f,b as D,e as y,i as F,j as v,l as w,_ as M,f as L,g as C}from"./index.1660443802877.js";import{G as B}from"./index.16604438028778.js";import{G as I}from"./index.16604438028775.js";import{aG as _,r as i,f as R,P as $,y as k,V as A,T as E,a8 as O,j as S}from"./vue.1660443802877.js";const h="/api/system/exitLog/";function x(){return{GetList:a=>f({url:h,method:"get",params:a}),AddObj:a=>f({url:h,method:"post",data:a}),UpdateObj:a=>f({url:h+a.id+"/",method:"put",data:a}),DelObj:a=>f({url:h+a+"/",method:"delete",data:{id:a}})}}function j(){let a=0,t=0;const o={data:i([]),loading:i(!1),dataL:i([]),loadingL:i(!1)},c=w.debounce(async s=>{console.log("fetching material",s),t+=1;const n=t;o.data.value=[],o.loading.value=!0;const u=await(await B({limit:20,page:1,FMaterialId:s})).data;if(console.log("fetching body",u),n!==t)return;const d=u.data.map(l=>({label:`${l.FMaterialId} (${l.FMaterialName})`,text:`${l.FMaterialId} (${l.FMaterialName})`,value:l.id}));o.data.value=d,o.loading.value=!1},800),m=w.debounce(async s=>{console.log("fetching location",s),a+=1;const n=a;o.dataL.value=[],o.loadingL.value=!0;const u=await(await I({limit:20,page:1,binCode:s})).data;if(console.log("fetching body",u),n!==a)return;const d=u.data.map(l=>({label:`${l.binCode} (${l.FStockID})`,text:`${l.binCode} (${l.FStockID})`,value:l.id}));o.dataL.value=d,o.loadingL.value=!1},800);return{fetchMaterial:c,fetchLocation:m,searchState:o}}function G({expose:a}){const{t}=D();_();const o=async e=>await x().GetList(e),c=async({form:e,row:p})=>(e.id=p.id,await x().UpdateObj(e)),m=async({row:e})=>await x().DelObj(e.id),s=async({form:e})=>await x().AddObj(e),{fetchMaterial:n,searchState:r,fetchLocation:u}=j(),d=i(!1),l=i(!1),b=R({});return{output:{dialogFormVisible:d,dialogDataVisible:l,curOpts:b},crudOptions:{request:{pageRequest:o,addRequest:s,editRequest:c,delRequest:m},search:{col:{span:4},options:{labelCol:{style:{width:"80px"}}}},table:{scroll:{x:1400},border:!0,bordered:!0,height:320,size:"small"},rowHandle:{fixed:"right",buttons:{exitBtn:{text:t("message.button.exit_wa"),title:"\u51FA\u5E93\u6309\u94AE",size:"small",order:0,type:"primary",click(e){b.value=e,l.value=!0}}}},columns:{id:{title:"ID",key:"id",type:"number",column:{width:50,show:!1},form:{show:!1}},FBillType:{title:t("app.exit.FBillType"),type:"dict-select",search:{show:!0,rules:null},dict:y({data:[{value:"SAL_OUTSTOCK",label:"\u9500\u552E\u51FA\u5E93\u5355",color:"primary"},{value:"STK_MisDelivery",label:"\u5176\u4ED6\u51FA\u5E93\u5355",color:"warning"},{value:"PUR_MRB",label:"\u91C7\u8D2D\u9000\u6599\u5355",color:"danger"}]}),form:{}},FStockMsg:{title:t("app.exit.FStockMsg"),type:"text",column:{fixed:"left"}},FDate:{title:t("app.exit.FDate"),type:"text",form:{}},FBillNo:{title:t("app.exit.FBillNo"),type:"text",form:{},search:{show:!0,rules:null,component:{style:{width:"100px"}}}},FCustomerID:{title:t("app.exit.FCustomerID"),type:"text",form:{}},exitQty:{title:t("app.exit.exitQty"),type:"text",form:{}},exitDate:{title:t("app.exit.exitDate"),type:"text",form:{}},FMaterialMsg:{title:t("app.exit.FMaterialMsg"),type:"text",form:{}},FPrice:{title:t("app.exit.FPrice"),type:"text"},FDocumentStatus:{title:t("app.exit.FDocumentStatus"),type:"dict-select",dict:y({data:[{value:"Z",label:"\u6682\u5B58",color:"warning"},{value:"A",label:"\u521B\u5EFA",color:"info"},{value:"B",label:"\u5BA1\u6838\u4E2D",color:"primary"},{value:"C",label:"\u5DF2\u5BA1\u6838",color:"success"},{value:"D",label:"\u91CD\u65B0\u5BA1\u6838",color:"danger"}]})},material:{title:t("app.exit.material"),type:"button",search:{show:!0,component:{style:{width:"240px"}},valueResolve({key:e,value:p,form:g}){p==""&&(g[e]=parseInt("0"))}},column:{show:!1,component:{show:F(({value:e})=>e!=null),on:{onClick({row:e}){v.success(t("app.exit.material")+e.binCode)}}}},form:{component:{name:"fs-dict-select",multiple:!1,filterable:!0,remote:!0,"reserve-keyword":!0,placeholder:t("app.material.FMaterialId"),options:r.data,remoteMethod:e=>{e!==""?n(e):r.data.value=[]},loading:r.loading}}},location:{title:t("app.exit.location"),type:"button",search:{show:!0,component:{style:{width:"240px"}},valueResolve({key:e,value:p,form:g}){p==""&&(g[e]=parseInt("0"))}},column:{show:!1,component:{show:F(({value:e})=>e!=null),on:{onClick({row:e}){v.success(t("app.exit.location")+e.location)}}}},form:{component:{name:"fs-dict-select",multiple:!1,filterable:!0,remote:!0,"reserve-keyword":!0,placeholder:t("app.location.binCode"),options:r.dataL,remoteMethod:e=>{e!==""?u(e):r.dataL.value=[]},loading:r.loadingL}}}}}}}const P=$({name:"tableExitLog",setup(){const a=i(),t=i(),{crudExpose:o}=L({crudRef:a,crudBinding:t}),{crudOptions:c}=G({crudExpose:o});return C({crudExpose:o,crudOptions:c}),k(()=>{o.doRefresh()}),{crudBinding:t,crudRef:a}}});function T(a,t,o,c,m,s){const n=O("fs-crud");return S(),A(n,E({ref:"crudRef"},a.crudBinding),null,16)}var z=M(P,[["render",T]]);export{z as default};
