import{u as pt,b as gt}from"./index2.1660443802877.js";import{B as yt,l as K}from"./index.1660443802877.js";import{j as vt,k as bt,g as mt}from"./vue.1660443802877.js";var ot=globalThis&&globalThis.__extends||function(){var o=function(r,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)n.hasOwnProperty(e)&&(i[e]=n[e])},o(r,t)};return function(r,t){o(r,t);function i(){this.constructor=r}r.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),m;(function(o){o.InvalidFile="InvalidFile",o.InvalidToken="InvalidToken",o.InvalidMetadata="InvalidMetadata",o.InvalidChunkSize="InvalidChunkSize",o.InvalidCustomVars="InvalidCustomVars",o.NotAvailableUploadHost="NotAvailableUploadHost",o.ReadCacheFailed="ReadCacheFailed",o.InvalidCacheData="InvalidCacheData",o.WriteCacheFailed="WriteCacheFailed",o.RemoveCacheFailed="RemoveCacheFailed",o.GetCanvasContextFailed="GetCanvasContextFailed",o.UnsupportedFileType="UnsupportedFileType",o.FileReaderReadFailed="FileReaderReadFailed",o.NotAvailableXMLHttpRequest="NotAvailableXMLHttpRequest",o.InvalidProgressEventTarget="InvalidProgressEventTarget",o.RequestError="RequestError"})(m||(m={}));var w=function(){function o(r,t){this.name=r,this.message=t,this.stack=new Error().stack}return o}(),E=function(o){ot(r,o);function r(t,i,n,e){var l=o.call(this,m.RequestError,n)||this;return l.code=t,l.reqId=i,l.isRequestError=!0,l.data=e,l}return r}(w),wt=function(o){ot(r,o);function r(t,i){return i===void 0&&(i=""),o.call(this,0,i,t)||this}return r}(E),_t=function(){function o(r,t){this.runTask=r,this.limit=t,this.queue=[],this.processing=[]}return o.prototype.enqueue=function(r){var t=this;return new Promise(function(i,n){t.queue.push({task:r,resolve:i,reject:n}),t.check()})},o.prototype.run=function(r){var t=this;this.queue=this.queue.filter(function(i){return i!==r}),this.processing.push(r),this.runTask(r.task).then(function(){t.processing=t.processing.filter(function(i){return i!==r}),r.resolve(),t.check()},function(i){return r.reject(i)})},o.prototype.check=function(){var r=this,t=this.processing.length,i=this.limit-t;this.queue.slice(0,i).forEach(function(n){r.run(n)})},o}(),xt=globalThis&&globalThis.__extends||function(){var o=function(r,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)n.hasOwnProperty(e)&&(i[e]=n[e])},o(r,t)};return function(r,t){o(r,t);function i(){this.constructor=r}r.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),P=globalThis&&globalThis.__assign||function(){return P=Object.assign||function(o){for(var r,t=1,i=arguments.length;t<i;t++){r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(o[n]=r[n])}return o},P.apply(this,arguments)},Tt=function(){function o(){this.closed=!1}return o.prototype.unsubscribe=function(){this.closed||(this.closed=!0,this._unsubscribe&&this._unsubscribe())},o.prototype.add=function(r){this._unsubscribe=r},o}(),Ct=function(o){xt(r,o);function r(t,i,n){var e=o.call(this)||this;return e.isStopped=!1,t&&typeof t=="object"?e.destination=t:e.destination=P(P(P({},t&&{next:t}),i&&{error:i}),n&&{complete:n}),e}return r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,o.prototype.unsubscribe.call(this))},r.prototype.next=function(t){!this.isStopped&&this.destination.next&&this.destination.next(t)},r.prototype.error=function(t){!this.isStopped&&this.destination.error&&(this.isStopped=!0,this.destination.error(t))},r.prototype.complete=function(t){!this.isStopped&&this.destination.complete&&(this.isStopped=!0,this.destination.complete(t))},r}(Tt),kt=function(){function o(r){this._subscribe=r}return o.prototype.subscribe=function(r,t,i){var n=new Ct(r,t,i);return n.add(this._subscribe(n)),n},o}();function St(o){if(o===null||typeof o=="undefined")return"";var r=o+"",t="",i,n,e=0;i=n=0,e=r.length;for(var l=0;l<e;l++){var d=r.charCodeAt(l),y=null;if(d<128)n++;else if(d>127&&d<2048)y=String.fromCharCode(d>>6|192,d&63|128);else if((d&63488^55296)>0)y=String.fromCharCode(d>>12|224,d>>6&63|128,d&63|128);else{if((d&64512^55296)>0)throw new RangeError("Unmatched trail surrogate at "+l);var a=r.charCodeAt(++l);if((a&64512^56320)>0)throw new RangeError("Unmatched lead surrogate at "+(l-1));d=((d&1023)<<10)+(a&1023)+65536,y=String.fromCharCode(d>>18|240,d>>12&63|128,d>>6&63|128,d&63|128)}y!==null&&(n>i&&(t+=r.slice(i,n)),t+=y,i=n=l+1)}return n>i&&(t+=r.slice(i,e)),t}function At(o){var r=[],t=0,i=0,n=0;for(o+="";t<o.length;){i=o.charCodeAt(t)&255,n=0,i<=191?(i=i&127,n=1):i<=223?(i=i&31,n=2):i<=239?(i=i&15,n=3):(i=i&7,n=4);for(var e=1;e<n;++e)i=i<<6|o.charCodeAt(e+t)&63;n===4?(i-=65536,r.push(String.fromCharCode(55296|i>>10&1023)),r.push(String.fromCharCode(56320|i&1023))):r.push(String.fromCharCode(i)),t+=n}return r.join("")}function It(o){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t,i,n,e,l,d,y,a,h=0,v=0,_="",T=[];if(!o)return o;o=St(o+"");do t=o.charCodeAt(h++),i=o.charCodeAt(h++),n=o.charCodeAt(h++),a=t<<16|i<<8|n,e=a>>18&63,l=a>>12&63,d=a>>6&63,y=a&63,T[v++]=r.charAt(e)+r.charAt(l)+r.charAt(d)+r.charAt(y);while(h<o.length);switch(_=T.join(""),o.length%3){case 1:_=_.slice(0,-2)+"==";break;case 2:_=_.slice(0,-1)+"=";break}return _}function Ut(o){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t,i,n,e,l,d,y,a,h=0,v=0,_="",T=[];if(!o)return o;o+="";do e=r.indexOf(o.charAt(h++)),l=r.indexOf(o.charAt(h++)),d=r.indexOf(o.charAt(h++)),y=r.indexOf(o.charAt(h++)),a=e<<18|l<<12|d<<6|y,t=a>>16&255,i=a>>8&255,n=a&255,d===64?T[v++]=String.fromCharCode(t):y===64?T[v++]=String.fromCharCode(t,i):T[v++]=String.fromCharCode(t,i,n);while(h<o.length);return _=T.join(""),At(_)}function at(o){return o=It(o),o.replace(/\//g,"_").replace(/\+/g,"-")}function Ft(o){return o=o.replace(/_/g,"/").replace(/-/g,"+"),Ut(o)}var st={exports:{}};(function(o,r){(function(t){o.exports=t()})(function(t){var i=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(g,p){var u=g[0],s=g[1],f=g[2],c=g[3];u+=(s&f|~s&c)+p[0]-680876936|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&f)+p[1]-389564586|0,c=(c<<12|c>>>20)+u|0,f+=(c&u|~c&s)+p[2]+606105819|0,f=(f<<17|f>>>15)+c|0,s+=(f&c|~f&u)+p[3]-1044525330|0,s=(s<<22|s>>>10)+f|0,u+=(s&f|~s&c)+p[4]-176418897|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&f)+p[5]+1200080426|0,c=(c<<12|c>>>20)+u|0,f+=(c&u|~c&s)+p[6]-1473231341|0,f=(f<<17|f>>>15)+c|0,s+=(f&c|~f&u)+p[7]-45705983|0,s=(s<<22|s>>>10)+f|0,u+=(s&f|~s&c)+p[8]+1770035416|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&f)+p[9]-1958414417|0,c=(c<<12|c>>>20)+u|0,f+=(c&u|~c&s)+p[10]-42063|0,f=(f<<17|f>>>15)+c|0,s+=(f&c|~f&u)+p[11]-1990404162|0,s=(s<<22|s>>>10)+f|0,u+=(s&f|~s&c)+p[12]+1804603682|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&f)+p[13]-40341101|0,c=(c<<12|c>>>20)+u|0,f+=(c&u|~c&s)+p[14]-1502002290|0,f=(f<<17|f>>>15)+c|0,s+=(f&c|~f&u)+p[15]+1236535329|0,s=(s<<22|s>>>10)+f|0,u+=(s&c|f&~c)+p[1]-165796510|0,u=(u<<5|u>>>27)+s|0,c+=(u&f|s&~f)+p[6]-1069501632|0,c=(c<<9|c>>>23)+u|0,f+=(c&s|u&~s)+p[11]+643717713|0,f=(f<<14|f>>>18)+c|0,s+=(f&u|c&~u)+p[0]-373897302|0,s=(s<<20|s>>>12)+f|0,u+=(s&c|f&~c)+p[5]-701558691|0,u=(u<<5|u>>>27)+s|0,c+=(u&f|s&~f)+p[10]+38016083|0,c=(c<<9|c>>>23)+u|0,f+=(c&s|u&~s)+p[15]-660478335|0,f=(f<<14|f>>>18)+c|0,s+=(f&u|c&~u)+p[4]-405537848|0,s=(s<<20|s>>>12)+f|0,u+=(s&c|f&~c)+p[9]+568446438|0,u=(u<<5|u>>>27)+s|0,c+=(u&f|s&~f)+p[14]-1019803690|0,c=(c<<9|c>>>23)+u|0,f+=(c&s|u&~s)+p[3]-187363961|0,f=(f<<14|f>>>18)+c|0,s+=(f&u|c&~u)+p[8]+1163531501|0,s=(s<<20|s>>>12)+f|0,u+=(s&c|f&~c)+p[13]-1444681467|0,u=(u<<5|u>>>27)+s|0,c+=(u&f|s&~f)+p[2]-51403784|0,c=(c<<9|c>>>23)+u|0,f+=(c&s|u&~s)+p[7]+1735328473|0,f=(f<<14|f>>>18)+c|0,s+=(f&u|c&~u)+p[12]-1926607734|0,s=(s<<20|s>>>12)+f|0,u+=(s^f^c)+p[5]-378558|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^f)+p[8]-2022574463|0,c=(c<<11|c>>>21)+u|0,f+=(c^u^s)+p[11]+1839030562|0,f=(f<<16|f>>>16)+c|0,s+=(f^c^u)+p[14]-35309556|0,s=(s<<23|s>>>9)+f|0,u+=(s^f^c)+p[1]-1530992060|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^f)+p[4]+1272893353|0,c=(c<<11|c>>>21)+u|0,f+=(c^u^s)+p[7]-155497632|0,f=(f<<16|f>>>16)+c|0,s+=(f^c^u)+p[10]-1094730640|0,s=(s<<23|s>>>9)+f|0,u+=(s^f^c)+p[13]+681279174|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^f)+p[0]-358537222|0,c=(c<<11|c>>>21)+u|0,f+=(c^u^s)+p[3]-722521979|0,f=(f<<16|f>>>16)+c|0,s+=(f^c^u)+p[6]+76029189|0,s=(s<<23|s>>>9)+f|0,u+=(s^f^c)+p[9]-640364487|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^f)+p[12]-421815835|0,c=(c<<11|c>>>21)+u|0,f+=(c^u^s)+p[15]+530742520|0,f=(f<<16|f>>>16)+c|0,s+=(f^c^u)+p[2]-995338651|0,s=(s<<23|s>>>9)+f|0,u+=(f^(s|~c))+p[0]-198630844|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~f))+p[7]+1126891415|0,c=(c<<10|c>>>22)+u|0,f+=(u^(c|~s))+p[14]-1416354905|0,f=(f<<15|f>>>17)+c|0,s+=(c^(f|~u))+p[5]-57434055|0,s=(s<<21|s>>>11)+f|0,u+=(f^(s|~c))+p[12]+1700485571|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~f))+p[3]-1894986606|0,c=(c<<10|c>>>22)+u|0,f+=(u^(c|~s))+p[10]-1051523|0,f=(f<<15|f>>>17)+c|0,s+=(c^(f|~u))+p[1]-2054922799|0,s=(s<<21|s>>>11)+f|0,u+=(f^(s|~c))+p[8]+1873313359|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~f))+p[15]-30611744|0,c=(c<<10|c>>>22)+u|0,f+=(u^(c|~s))+p[6]-1560198380|0,f=(f<<15|f>>>17)+c|0,s+=(c^(f|~u))+p[13]+1309151649|0,s=(s<<21|s>>>11)+f|0,u+=(f^(s|~c))+p[4]-145523070|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~f))+p[11]-1120210379|0,c=(c<<10|c>>>22)+u|0,f+=(u^(c|~s))+p[2]+718787259|0,f=(f<<15|f>>>17)+c|0,s+=(c^(f|~u))+p[9]-343485551|0,s=(s<<21|s>>>11)+f|0,g[0]=u+g[0]|0,g[1]=s+g[1]|0,g[2]=f+g[2]|0,g[3]=c+g[3]|0}function e(g){var p=[],u;for(u=0;u<64;u+=4)p[u>>2]=g.charCodeAt(u)+(g.charCodeAt(u+1)<<8)+(g.charCodeAt(u+2)<<16)+(g.charCodeAt(u+3)<<24);return p}function l(g){var p=[],u;for(u=0;u<64;u+=4)p[u>>2]=g[u]+(g[u+1]<<8)+(g[u+2]<<16)+(g[u+3]<<24);return p}function d(g){var p=g.length,u=[1732584193,-271733879,-1732584194,271733878],s,f,c,x,C,k;for(s=64;s<=p;s+=64)n(u,e(g.substring(s-64,s)));for(g=g.substring(s-64),f=g.length,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<f;s+=1)c[s>>2]|=g.charCodeAt(s)<<(s%4<<3);if(c[s>>2]|=128<<(s%4<<3),s>55)for(n(u,c),s=0;s<16;s+=1)c[s]=0;return x=p*8,x=x.toString(16).match(/(.*?)(.{0,8})$/),C=parseInt(x[2],16),k=parseInt(x[1],16)||0,c[14]=C,c[15]=k,n(u,c),u}function y(g){var p=g.length,u=[1732584193,-271733879,-1732584194,271733878],s,f,c,x,C,k;for(s=64;s<=p;s+=64)n(u,l(g.subarray(s-64,s)));for(g=s-64<p?g.subarray(s-64):new Uint8Array(0),f=g.length,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<f;s+=1)c[s>>2]|=g[s]<<(s%4<<3);if(c[s>>2]|=128<<(s%4<<3),s>55)for(n(u,c),s=0;s<16;s+=1)c[s]=0;return x=p*8,x=x.toString(16).match(/(.*?)(.{0,8})$/),C=parseInt(x[2],16),k=parseInt(x[1],16)||0,c[14]=C,c[15]=k,n(u,c),u}function a(g){var p="",u;for(u=0;u<4;u+=1)p+=i[g>>u*8+4&15]+i[g>>u*8&15];return p}function h(g){var p;for(p=0;p<g.length;p+=1)g[p]=a(g[p]);return g.join("")}h(d("hello")),typeof ArrayBuffer!="undefined"&&!ArrayBuffer.prototype.slice&&function(){function g(p,u){return p=p|0||0,p<0?Math.max(p+u,0):Math.min(p,u)}ArrayBuffer.prototype.slice=function(p,u){var s=this.byteLength,f=g(p,s),c=s,x,C,k,W;return u!==t&&(c=g(u,s)),f>c?new ArrayBuffer(0):(x=c-f,C=new ArrayBuffer(x),k=new Uint8Array(C),W=new Uint8Array(this,f,x),k.set(W),C)}}();function v(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function _(g,p){var u=g.length,s=new ArrayBuffer(u),f=new Uint8Array(s),c;for(c=0;c<u;c+=1)f[c]=g.charCodeAt(c);return p?f:s}function T(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function O(g,p,u){var s=new Uint8Array(g.byteLength+p.byteLength);return s.set(new Uint8Array(g)),s.set(new Uint8Array(p),g.byteLength),u?s:s.buffer}function H(g){var p=[],u=g.length,s;for(s=0;s<u-1;s+=2)p.push(parseInt(g.substr(s,2),16));return String.fromCharCode.apply(String,p)}function b(){this.reset()}return b.prototype.append=function(g){return this.appendBinary(v(g)),this},b.prototype.appendBinary=function(g){this._buff+=g,this._length+=g.length;var p=this._buff.length,u;for(u=64;u<=p;u+=64)n(this._hash,e(this._buff.substring(u-64,u)));return this._buff=this._buff.substring(u-64),this},b.prototype.end=function(g){var p=this._buff,u=p.length,s,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c;for(s=0;s<u;s+=1)f[s>>2]|=p.charCodeAt(s)<<(s%4<<3);return this._finish(f,u),c=h(this._hash),g&&(c=H(c)),this.reset(),c},b.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},b.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},b.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},b.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},b.prototype._finish=function(g,p){var u=p,s,f,c;if(g[u>>2]|=128<<(u%4<<3),u>55)for(n(this._hash,g),u=0;u<16;u+=1)g[u]=0;s=this._length*8,s=s.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(s[2],16),c=parseInt(s[1],16)||0,g[14]=f,g[15]=c,n(this._hash,g)},b.hash=function(g,p){return b.hashBinary(v(g),p)},b.hashBinary=function(g,p){var u=d(g),s=h(u);return p?H(s):s},b.ArrayBuffer=function(){this.reset()},b.ArrayBuffer.prototype.append=function(g){var p=O(this._buff.buffer,g,!0),u=p.length,s;for(this._length+=g.byteLength,s=64;s<=u;s+=64)n(this._hash,l(p.subarray(s-64,s)));return this._buff=s-64<u?new Uint8Array(p.buffer.slice(s-64)):new Uint8Array(0),this},b.ArrayBuffer.prototype.end=function(g){var p=this._buff,u=p.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f,c;for(f=0;f<u;f+=1)s[f>>2]|=p[f]<<(f%4<<3);return this._finish(s,u),c=h(this._hash),g&&(c=H(c)),this.reset(),c},b.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},b.ArrayBuffer.prototype.getState=function(){var g=b.prototype.getState.call(this);return g.buff=T(g.buff),g},b.ArrayBuffer.prototype.setState=function(g){return g.buff=_(g.buff,!0),b.prototype.setState.call(this,g)},b.ArrayBuffer.prototype.destroy=b.prototype.destroy,b.ArrayBuffer.prototype._finish=b.prototype._finish,b.ArrayBuffer.hash=function(g,p){var u=y(new Uint8Array(g)),s=h(u);return p?H(s):s},b})})(st);var Ot=st.exports,M=globalThis&&globalThis.__assign||function(){return M=Object.assign||function(o){for(var r,t=1,i=arguments.length;t<i;t++){r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(o[n]=r[n])}return o},M.apply(this,arguments)},zt=globalThis&&globalThis.__awaiter||function(o,r,t,i){function n(e){return e instanceof t?e:new t(function(l){l(e)})}return new(t||(t=Promise))(function(e,l){function d(h){try{a(i.next(h))}catch(v){l(v)}}function y(h){try{a(i.throw(h))}catch(v){l(v)}}function a(h){h.done?e(h.value):n(h.value).then(d,y)}a((i=i.apply(o,r||[])).next())})},Pt=globalThis&&globalThis.__generator||function(o,r){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(a){return function(h){return y([a,h])}}function y(a){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(e=a[0]&2?n.return:a[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,a[1])).done)return e;switch(n=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,n=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=r.call(o,t)}catch(h){a=[6,h],n=0}finally{i=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},U=Math.pow(1024,2);function Rt(o,r){var t=r*U;if(t>o.size)t=o.size;else for(;o.size>t*1e4;)t*=2;for(var i=[],n=Math.ceil(o.size/t),e=0;e<n;e++){var l=o.slice(t*e,e===n-1?o.size:t*(e+1));i.push(l)}return i}function Et(o){return Object.keys(o).every(function(r){return r.indexOf("x-qn-meta-")===0})}function Lt(o){return Object.keys(o).every(function(r){return r.indexOf("x:")===0})}function Ht(o){return o.reduce(function(r,t){return r+t},0)}function qt(o,r,t){try{localStorage.setItem(o,JSON.stringify(r))}catch{t.warn(new w(m.WriteCacheFailed,"setLocalFileInfo failed: "+o))}}function Bt(o,r,t){var i=r==null?"_":"_key_"+r+"_";return"qiniu_js_sdk_upload_file_name_"+o+i+"size_"+t}function X(o,r){try{localStorage.removeItem(o)}catch{r.warn(new w(m.RemoveCacheFailed,"removeLocalFileInfo failed. key: "+o))}}function Dt(o,r){var t=null;try{t=localStorage.getItem(o)}catch{r.warn(new w(m.ReadCacheFailed,"getLocalFileInfo failed. key: "+o))}if(t==null)return null;var i=null;try{i=JSON.parse(t)}catch{X(o,r),r.warn(new w(m.InvalidCacheData,"getLocalFileInfo failed to parse. key: "+o))}return i}function $(o){var r="UpToken "+o;return{Authorization:r}}function Mt(o){var r=$(o);return M({"content-type":"application/octet-stream"},r)}function jt(o){var r=$(o);return M({"content-type":"application/json"},r)}function ut(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)return new window.ActiveXObject("Microsoft.XMLHTTP");throw new w(m.NotAvailableXMLHttpRequest,"the current environment does not support.")}function $t(o){return zt(this,void 0,void 0,function(){var r,t;return Pt(this,function(i){switch(i.label){case 0:return[4,Vt(o)];case 1:return r=i.sent(),t=new Ot.ArrayBuffer,t.append(r),[2,t.end()]}})})}function Vt(o){return new Promise(function(r,t){var i=new FileReader;i.onload=function(n){if(n.target){var e=n.target.result;r(e)}else t(new w(m.InvalidProgressEventTarget,"progress event target is undefined"))},i.onerror=function(){t(new w(m.FileReaderReadFailed,"fileReader read failed"))},i.readAsArrayBuffer(o)})}function L(o,r){return new Promise(function(t,i){var n=ut();if(n.open(r.method,o),r.onCreate&&r.onCreate(n),r.headers){var e=r.headers;Object.keys(e).forEach(function(l){n.setRequestHeader(l,e[l])})}n.upload.addEventListener("progress",function(l){l.lengthComputable&&r.onProgress&&r.onProgress({loaded:l.loaded,total:l.total})}),n.onreadystatechange=function(){var l=n.responseText;if(n.readyState===4){var d=n.getResponseHeader("x-reqId")||"";if(n.status===0){i(new wt("network error.",d));return}if(n.status!==200){var y="xhr request failed, code: "+n.status;l&&(y+=" response: "+l);var a=void 0;try{a=JSON.parse(l)}catch{}i(new E(n.status,d,y,a));return}try{t({data:JSON.parse(l),reqId:d})}catch(h){i(h)}}},n.send(r.body)})}function Gt(o){if(o&&o.match){var r=o.match(/(^https?)/);if(!r)return"";var t=r[1];return r=o.match(/^https?:\/\/([^:^/]*):(\d*)/),r?r[2]:t==="http"?"80":"443"}return""}function Xt(o){if(o&&o.match){var r=o.match(/^https?:\/\/([^:^/]*)/);return r?r[1]:""}return""}function J(o){if(!o)throw new w(m.InvalidToken,"invalid token.");var r=o.split(":");if(r.length===1)throw new w(m.InvalidToken,"invalid token segments.");var t=r.length>3?r[1]:r[0];if(!t)throw new w(m.InvalidToken,"missing assess key field.");var i=null;try{i=JSON.parse(Ft(r[r.length-1]))}catch{throw new w(m.InvalidToken,"token parse failed.")}if(i==null)throw new w(m.InvalidToken,"putPolicy is null.");if(i.scope==null)throw new w(m.InvalidToken,"scope field is null.");var n=i.scope.split(":")[0];if(!n)throw new w(m.InvalidToken,"resolve bucketName failed.");return{assessKey:t,bucketName:n,scope:i.scope}}var S,I={z0:"z0",z1:"z1",z2:"z2",na0:"na0",as0:"as0",cnEast2:"cn-east-2"},Nt=(S={},S[I.z0]={srcUphost:["up.qiniup.com"],cdnUphost:["upload.qiniup.com"]},S[I.z1]={srcUphost:["up-z1.qiniup.com"],cdnUphost:["upload-z1.qiniup.com"]},S[I.z2]={srcUphost:["up-z2.qiniup.com"],cdnUphost:["upload-z2.qiniup.com"]},S[I.na0]={srcUphost:["up-na0.qiniup.com"],cdnUphost:["upload-na0.qiniup.com"]},S[I.as0]={srcUphost:["up-as0.qiniup.com"],cdnUphost:["upload-as0.qiniup.com"]},S[I.cnEast2]={srcUphost:["up-cn-east-2.qiniup.com"],cdnUphost:["upload-cn-east-2.qiniup.com"]},S),z=function(o){switch(typeof o){case"string":return o;case"boolean":return o?"true":"false";case"number":return isFinite(o)?o:"";default:return""}},Jt=function(o,r,t,i){return r=r||"&",t=t||"=",o===null&&(o=void 0),typeof o=="object"?Object.keys(o).map(function(n){var e=encodeURIComponent(z(n))+t;return Array.isArray(o[n])?o[n].map(function(l){return e+encodeURIComponent(z(l))}).join(r):e+encodeURIComponent(z(o[n]))}).filter(Boolean).join(r):i?encodeURIComponent(z(i))+t+encodeURIComponent(z(o)):""},lt;lt=Jt;var A=globalThis&&globalThis.__assign||function(){return A=Object.assign||function(o){for(var r,t=1,i=arguments.length;t<i;t++){r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(o[n]=r[n])}return o},A.apply(this,arguments)},Wt=globalThis&&globalThis.__awaiter||function(o,r,t,i){function n(e){return e instanceof t?e:new t(function(l){l(e)})}return new(t||(t=Promise))(function(e,l){function d(h){try{a(i.next(h))}catch(v){l(v)}}function y(h){try{a(i.throw(h))}catch(v){l(v)}}function a(h){h.done?e(h.value):n(h.value).then(d,y)}a((i=i.apply(o,r||[])).next())})},Kt=globalThis&&globalThis.__generator||function(o,r){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(a){return function(h){return y([a,h])}}function y(a){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(e=a[0]&2?n.return:a[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,a[1])).done)return e;switch(n=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,n=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=r.call(o,t)}catch(h){a=[6,h],n=0}finally{i=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function Zt(o,r,t){return Wt(this,void 0,void 0,function(){var i,n;return Kt(this,function(e){return i=lt({ak:o,bucket:r}),n=t+"://api.qiniu.com/v2/query?"+i,[2,L(n,{method:"GET"})]})})}function ct(o,r,t){var i=t.url,n=t.id;return i+"/buckets/"+o+"/objects/"+(r!=null?at(r):"~")+"/uploads/"+n}function Yt(o,r,t,i){var n=i+"/buckets/"+r+"/objects/"+(t!=null?at(t):"~")+"/uploads";return L(n,{method:"POST",headers:$(o)})}function Qt(o,r,t,i,n){var e=J(o).bucketName,l=ct(e,r,i)+("/"+t),d=Mt(o);return n.md5&&(d["Content-MD5"]=n.md5),L(l,A(A({},n),{method:"PUT",headers:d}))}function te(o,r,t,i){var n=J(o).bucketName,e=ct(n,r,t);return L(e,A(A({},i),{method:"POST",headers:jt(o)}))}function ee(o,r,t){return L(o,A({method:"POST",body:r},t))}var j=globalThis&&globalThis.__assign||function(){return j=Object.assign||function(o){for(var r,t=1,i=arguments.length;t<i;t++){r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(o[n]=r[n])}return o},j.apply(this,arguments)},Z=globalThis&&globalThis.__awaiter||function(o,r,t,i){function n(e){return e instanceof t?e:new t(function(l){l(e)})}return new(t||(t=Promise))(function(e,l){function d(h){try{a(i.next(h))}catch(v){l(v)}}function y(h){try{a(i.throw(h))}catch(v){l(v)}}function a(h){h.done?e(h.value):n(h.value).then(d,y)}a((i=i.apply(o,r||[])).next())})},Y=globalThis&&globalThis.__generator||function(o,r){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(a){return function(h){return y([a,h])}}function y(a){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(e=a[0]&2?n.return:a[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,a[1])).done)return e;switch(n=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,n=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=r.call(o,t)}catch(h){a=[6,h],n=0}finally{i=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},re=globalThis&&globalThis.__read||function(o,r){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var i=t.call(o),n,e=[],l;try{for(;(r===void 0||r-- >0)&&!(n=i.next()).done;)e.push(n.value)}catch(d){l={error:d}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(l)throw l.error}}return e},ne=globalThis&&globalThis.__spread||function(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(re(arguments[r]));return o},ie=4,ft=[0,502,503,504,599],oe=ne(ft,[612]),ae=Math.pow(1024,3),ht=function(){function o(r,t,i,n){this.hostPool=i,this.logger=n,this.aborted=!1,this.retryCount=0,this.xhrList=[],this.config=r.config,n.info("config inited.",this.config),this.putExtra=j({fname:""},r.putExtra),n.info("putExtra inited.",this.putExtra),this.key=r.key,this.file=r.file,this.token=r.token,this.onData=t.onData,this.onError=t.onError,this.onComplete=t.onComplete;try{var e=J(this.token);this.bucketName=e.bucketName,this.assessKey=e.assessKey}catch(l){n.error("get putPolicy from token failed.",l),this.onError(l)}}return o.prototype.checkAndUpdateUploadHost=function(){return Z(this,void 0,void 0,function(){var r;return Y(this,function(t){switch(t.label){case 0:return this.logger.info("get available upload host."),[4,this.hostPool.getUp(this.assessKey,this.bucketName,this.config.upprotocol)];case 1:if(r=t.sent(),r==null)throw new w(m.NotAvailableUploadHost,"no available upload host.");return this.uploadHost!=null&&this.uploadHost.host!==r.host?this.logger.warn("host switches from "+this.uploadHost.host+" to "+r.host+"."):this.logger.info("use host "+r.host+"."),this.uploadHost=r,[2]}})})},o.prototype.checkAndUnfreezeHost=function(){this.logger.info("check unfreeze host."),this.uploadHost!=null&&this.uploadHost.isFrozen()&&(this.logger.warn(this.uploadHost.host+" will be unfrozen."),this.uploadHost.unfreeze())},o.prototype.checkAndFreezeHost=function(r){this.logger.info("check freeze host."),r instanceof E&&this.uploadHost!=null&&ft.includes(r.code)&&(this.logger.warn(this.uploadHost.host+" will be temporarily frozen."),this.uploadHost.freeze())},o.prototype.handleError=function(r){this.logger.error(r.message),this.onError(r)},o.prototype.putFile=function(){return Z(this,void 0,void 0,function(){var r,t,i,n,e,l;return Y(this,function(d){switch(d.label){case 0:if(this.aborted=!1,this.putExtra.fname||(this.logger.info("use file.name as fname."),this.putExtra.fname=this.file.name),this.file.size>1e4*ae)return this.handleError(new w(m.InvalidFile,"file size exceed maximum value 10000G")),[2];if(this.putExtra.customVars&&!Lt(this.putExtra.customVars))return this.handleError(new w(m.InvalidCustomVars,"customVars key should start width x:")),[2];if(this.putExtra.metadata&&!Et(this.putExtra.metadata))return this.handleError(new w(m.InvalidMetadata,"metadata key should start with x-qn-meta-")),[2];d.label=1;case 1:return d.trys.push([1,4,,5]),this.uploadAt=new Date().getTime(),[4,this.checkAndUpdateUploadHost()];case 2:return d.sent(),[4,this.run()];case 3:return r=d.sent(),this.onComplete(r.data),this.checkAndUnfreezeHost(),this.sendLog(r.reqId,200),[2];case 4:return t=d.sent(),this.logger.error(t),this.clear(),t instanceof E&&(i=this.aborted?"":t.reqId,n=this.aborted?-2:t.code,this.sendLog(i,n),this.checkAndFreezeHost(t),e=++this.retryCount<=this.config.retryCount,l=!this.aborted&&oe.includes(t.code),l&&e)?(this.logger.warn("error auto retry: "+this.retryCount+"/"+this.config.retryCount+"."),this.putFile(),[2]):(this.onError(t),[3,5]);case 5:return[2]}})})},o.prototype.clear=function(){this.logger.info("start cleaning all xhr."),this.xhrList.forEach(function(r){r.onreadystatechange=null,r.abort()}),this.logger.info("cleanup completed."),this.xhrList=[]},o.prototype.stop=function(){this.logger.info("stop."),this.clear(),this.aborted=!0},o.prototype.addXhr=function(r){this.xhrList.push(r)},o.prototype.sendLog=function(r,t){var i,n;this.logger.report({code:t,reqId:r,remoteIp:"",upType:"jssdk-h5",size:this.file.size,time:Math.floor(this.uploadAt/1e3),port:Gt((i=this.uploadHost)===null||i===void 0?void 0:i.getUrl()),host:Xt((n=this.uploadHost)===null||n===void 0?void 0:n.getUrl()),bytesSent:this.progress?this.progress.total.loaded:0,duration:Math.floor((new Date().getTime()-this.uploadAt)/1e3)})},o.prototype.getProgressInfoItem=function(r,t,i){return j({size:t,loaded:r,percent:r/t*100},i==null?{}:{fromCache:i})},o}(),se=globalThis&&globalThis.__extends||function(){var o=function(r,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)n.hasOwnProperty(e)&&(i[e]=n[e])},o(r,t)};return function(r,t){o(r,t);function i(){this.constructor=r}r.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),R=globalThis&&globalThis.__assign||function(){return R=Object.assign||function(o){for(var r,t=1,i=arguments.length;t<i;t++){r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(o[n]=r[n])}return o},R.apply(this,arguments)},q=globalThis&&globalThis.__awaiter||function(o,r,t,i){function n(e){return e instanceof t?e:new t(function(l){l(e)})}return new(t||(t=Promise))(function(e,l){function d(h){try{a(i.next(h))}catch(v){l(v)}}function y(h){try{a(i.throw(h))}catch(v){l(v)}}function a(h){h.done?e(h.value):n(h.value).then(d,y)}a((i=i.apply(o,r||[])).next())})},B=globalThis&&globalThis.__generator||function(o,r){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(a){return function(h){return y([a,h])}}function y(a){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(e=a[0]&2?n.return:a[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,a[1])).done)return e;switch(n=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,n=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=r.call(o,t)}catch(h){a=[6,h],n=0}finally{i=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function ue(o){var r=/^[1-9]\d*$/;return r.test(String(o))}var le=function(o){se(r,o);function r(){return o!==null&&o.apply(this,arguments)||this}return r.prototype.run=function(){return q(this,void 0,void 0,function(){var t,i,n,e,l,d=this;return B(this,function(y){switch(y.label){case 0:if(this.logger.info("start run Resume."),!this.config.chunkSize||!ue(this.config.chunkSize))throw new w(m.InvalidChunkSize,"chunkSize must be a positive integer");if(this.config.chunkSize>1024)throw new w(m.InvalidChunkSize,"chunkSize maximum value is 1024");return[4,this.initBeforeUploadChunks()];case 1:y.sent(),t=new _t(function(a){return d.uploadChunk(a)},this.config.concurrentRequestLimit),i=null,n=this.getLocalKey(),e=this.chunks.map(function(a,h){return t.enqueue({chunk:a,index:h})}),y.label=2;case 2:return y.trys.push([2,5,,6]),[4,Promise.all(e)];case 3:return y.sent(),[4,this.mkFileReq()];case 4:return i=y.sent(),[3,6];case 5:throw l=y.sent(),l instanceof E&&(l.code===612||l.code===400)&&X(n,this.logger),l;case 6:return X(n,this.logger),[2,i]}})})},r.prototype.uploadChunk=function(t){return q(this,void 0,void 0,function(){var i,n,e,l,d,y,a,h,v,_=this;return B(this,function(T){switch(T.label){case 0:return i=t.index,n=t.chunk,e=this.cachedUploadedList[i],this.logger.info("upload part "+i+", cache:",e),l=this.config.checkByMD5,d=function(){_.usedCacheList[i]=!0,_.updateChunkProgress(n.size,i),_.uploadedList[i]=e,_.updateLocalCache()},e&&!l?(d(),[2]):[4,$t(n)];case 1:return y=T.sent(),this.logger.info("computed part md5.",y),e&&y===e.md5?(d(),[2]):(this.usedCacheList[i]=!1,a=function(O){_.updateChunkProgress(O.loaded,i)},h={body:n,md5:this.config.checkByServer?y:void 0,onProgress:a,onCreate:function(O){return _.addXhr(O)}},this.logger.info("part "+i+" start uploading."),[4,Qt(this.token,this.key,t.index+1,this.getUploadInfo(),h)]);case 2:return v=T.sent(),this.logger.info("part "+i+" upload completed."),a({loaded:n.size,total:n.size}),this.uploadedList[i]={etag:v.data.etag,md5:v.data.md5,size:n.size},this.updateLocalCache(),[2]}})})},r.prototype.mkFileReq=function(){return q(this,void 0,void 0,function(){var t,i,n=this;return B(this,function(e){switch(e.label){case 0:return t=R(R(R({parts:this.uploadedList.map(function(l,d){return{etag:l.etag,partNumber:d+1}}),fname:this.putExtra.fname},this.putExtra.mimeType&&{mimeType:this.putExtra.mimeType}),this.putExtra.customVars&&{customVars:this.putExtra.customVars}),this.putExtra.metadata&&{metadata:this.putExtra.metadata}),this.logger.info("parts upload completed, make file.",t),[4,te(this.token,this.key,this.getUploadInfo(),{onCreate:function(l){return n.addXhr(l)},body:JSON.stringify(t)})];case 1:return i=e.sent(),this.logger.info("finish Resume Progress."),this.updateMkFileProgress(1),[2,i]}})})},r.prototype.initBeforeUploadChunks=function(){return q(this,void 0,void 0,function(){var t,i,n;return B(this,function(e){switch(e.label){case 0:return this.uploadedList=[],this.usedCacheList=[],t=Dt(this.getLocalKey(),this.logger),t?[3,2]:(this.logger.info("init upload parts from api."),[4,Yt(this.token,this.bucketName,this.key,this.uploadHost.getUrl())]);case 1:return i=e.sent(),this.logger.info("initd upload parts of id: "+i.data.uploadId+"."),this.uploadId=i.data.uploadId,this.cachedUploadedList=[],[3,3];case 2:n=["resume upload parts from local cache,","total "+t.data.length+" part,","id is "+t.id+"."],this.logger.info(n.join(" ")),this.cachedUploadedList=t.data,this.uploadId=t.id,e.label=3;case 3:return this.chunks=Rt(this.file,this.config.chunkSize),this.loaded={mkFileProgress:0,chunks:this.chunks.map(function(l){return 0})},this.notifyResumeProgress(),[2]}})})},r.prototype.getUploadInfo=function(){return{id:this.uploadId,url:this.uploadHost.getUrl()}},r.prototype.getLocalKey=function(){return Bt(this.file.name,this.key,this.file.size)},r.prototype.updateLocalCache=function(){qt(this.getLocalKey(),{id:this.uploadId,data:this.uploadedList},this.logger)},r.prototype.updateChunkProgress=function(t,i){this.loaded.chunks[i]=t,this.notifyResumeProgress()},r.prototype.updateMkFileProgress=function(t){this.loaded.mkFileProgress=t,this.notifyResumeProgress()},r.prototype.notifyResumeProgress=function(){var t=this;this.progress={total:this.getProgressInfoItem(Ht(this.loaded.chunks)+this.loaded.mkFileProgress,this.file.size+1),chunks:this.chunks.map(function(i,n){var e=t.usedCacheList[n];return t.getProgressInfoItem(t.loaded.chunks[n],i.size,e)}),uploadInfo:{id:this.uploadId,url:this.uploadHost.getUrl()}},this.onData(this.progress)},r}(ht),Q=globalThis&&globalThis.__awaiter||function(o,r,t,i){function n(e){return e instanceof t?e:new t(function(l){l(e)})}return new(t||(t=Promise))(function(e,l){function d(h){try{a(i.next(h))}catch(v){l(v)}}function y(h){try{a(i.throw(h))}catch(v){l(v)}}function a(h){h.done?e(h.value):n(h.value).then(d,y)}a((i=i.apply(o,r||[])).next())})},tt=globalThis&&globalThis.__generator||function(o,r){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(a){return function(h){return y([a,h])}}function y(a){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(e=a[0]&2?n.return:a[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,a[1])).done)return e;switch(n=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,n=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=r.call(o,t)}catch(h){a=[6,h],n=0}finally{i=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},ce=function(){function o(){this.crc=-1,this.table=this.makeTable()}return o.prototype.makeTable=function(){for(var r=new Array,t=0;t<256;t++){for(var i=t,n=0;n<8;n++)i&1?i=i>>>1^3988292384:i>>>=1;r[t]=i}return r},o.prototype.append=function(r){for(var t=this.crc,i=0;i<r.byteLength;i++)t=t>>>8^this.table[(t^r[i])&255];this.crc=t},o.prototype.compute=function(){return(this.crc^-1)>>>0},o.prototype.readAsUint8Array=function(r){return Q(this,void 0,void 0,function(){var t;return tt(this,function(i){switch(i.label){case 0:return typeof r.arrayBuffer!="function"?[3,2]:(t=Uint8Array.bind,[4,r.arrayBuffer()]);case 1:return[2,new(t.apply(Uint8Array,[void 0,i.sent()]))];case 2:return[2,new Promise(function(n,e){var l=new FileReader;l.onload=function(){if(l.result==null){e();return}if(typeof l.result=="string"){e();return}n(new Uint8Array(l.result))},l.readAsArrayBuffer(r)})]}})})},o.prototype.file=function(r){return Q(this,void 0,void 0,function(){var t,i,n,e,l,d;return tt(this,function(y){switch(y.label){case 0:return r.size<=U?(t=this.append,[4,this.readAsUint8Array(r)]):[3,2];case 1:return t.apply(this,[y.sent()]),[2,this.compute()];case 2:i=Math.ceil(r.size/U),n=0,y.label=3;case 3:return n<i?(e=n*U,l=n===i-1?r.size:e+U,[4,this.readAsUint8Array(r.slice(e,l))]):[3,6];case 4:d=y.sent(),this.append(new Uint8Array(d)),y.label=5;case 5:return n++,[3,3];case 6:return[2,this.compute()]}})})},o.file=function(r){var t=new o;return t.file(r)},o}(),fe=globalThis&&globalThis.__extends||function(){var o=function(r,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var e in n)n.hasOwnProperty(e)&&(i[e]=n[e])},o(r,t)};return function(r,t){o(r,t);function i(){this.constructor=r}r.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),he=globalThis&&globalThis.__awaiter||function(o,r,t,i){function n(e){return e instanceof t?e:new t(function(l){l(e)})}return new(t||(t=Promise))(function(e,l){function d(h){try{a(i.next(h))}catch(v){l(v)}}function y(h){try{a(i.throw(h))}catch(v){l(v)}}function a(h){h.done?e(h.value):n(h.value).then(d,y)}a((i=i.apply(o,r||[])).next())})},de=globalThis&&globalThis.__generator||function(o,r){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(a){return function(h){return y([a,h])}}function y(a){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(e=a[0]&2?n.return:a[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,a[1])).done)return e;switch(n=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,n=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=r.call(o,t)}catch(h){a=[6,h],n=0}finally{i=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},et=function(o){fe(r,o);function r(){return o!==null&&o.apply(this,arguments)||this}return r.prototype.run=function(){return he(this,void 0,void 0,function(){var t,i,n,e,l=this;return de(this,function(d){switch(d.label){case 0:return this.logger.info("start run Direct."),t=new FormData,t.append("file",this.file),t.append("token",this.token),this.key!=null&&t.append("key",this.key),t.append("fname",this.putExtra.fname),this.config.checkByServer?[4,ce.file(this.file)]:[3,2];case 1:i=d.sent(),t.append("crc32",i.toString()),d.label=2;case 2:return this.putExtra.customVars&&(this.logger.info("init customVars."),n=this.putExtra.customVars,Object.keys(n).forEach(function(y){return t.append(y,n[y].toString())}),this.logger.info("customVars inited.")),this.logger.info("formData inited."),[4,ee(this.uploadHost.getUrl(),t,{onProgress:function(y){l.updateDirectProgress(y.loaded,y.total)},onCreate:function(y){return l.addXhr(y)}})];case 3:return e=d.sent(),this.logger.info("Direct progress finish."),this.finishDirectProgress(),[2,e]}})})},r.prototype.updateDirectProgress=function(t,i){this.progress={total:this.getProgressInfoItem(t,i+1)},this.onData(this.progress)},r.prototype.finishDirectProgress=function(){if(!this.progress){this.logger.warn("progress is null."),this.progress={total:this.getProgressInfoItem(this.file.size,this.file.size)},this.onData(this.progress);return}var t=this.progress.total;this.progress={total:this.getProgressInfoItem(t.loaded+1,t.size)},this.onData(this.progress)},r}(ht);function dt(o,r,t){t===void 0&&(t=3);var i=ut();i.open("POST","https://uplog.qbox.me/log/3"),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.setRequestHeader("Authorization",$(o).Authorization),i.onreadystatechange=function(){i.readyState===4&&i.status!==200&&t>0&&dt(o,r,t-1)};var n=[r.code||"",r.reqId||"",r.host||"",r.remoteIp||"",r.port||"",r.duration||"",r.time||"",r.bytesSent||"",r.upType||"",r.size||""].join(",");i.send(n)}var pe=globalThis&&globalThis.__read||function(o,r){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var i=t.call(o),n,e=[],l;try{for(;(r===void 0||r-- >0)&&!(n=i.next()).done;)e.push(n.value)}catch(d){l={error:d}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(l)throw l.error}}return e},V=globalThis&&globalThis.__spread||function(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(pe(arguments[r]));return o},ge=function(){function o(r,t,i,n){t===void 0&&(t=!0),i===void 0&&(i="OFF"),n===void 0&&(n="UPLOAD"),this.token=r,this.disableReport=t,this.level=i,this.prefix=n,this.id=++o.id}return o.prototype.getPrintPrefix=function(r){return"Qiniu-JS-SDK ["+r+"]["+this.prefix+"#"+this.id+"]:"},o.prototype.report=function(r,t){if(!this.disableReport)try{dt(this.token,r,t)}catch(i){this.warn(i)}},o.prototype.info=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var i=["INFO"];i.includes(this.level)&&console.log.apply(console,V([this.getPrintPrefix("INFO")],r))},o.prototype.warn=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var i=["INFO","WARN"];i.includes(this.level)&&console.warn.apply(console,V([this.getPrintPrefix("WARN")],r))},o.prototype.error=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var i=["INFO","WARN","ERROR"];i.includes(this.level)&&console.error.apply(console,V([this.getPrintPrefix("ERROR")],r))},o.id=0,o}(),rt=globalThis&&globalThis.__awaiter||function(o,r,t,i){function n(e){return e instanceof t?e:new t(function(l){l(e)})}return new(t||(t=Promise))(function(e,l){function d(h){try{a(i.next(h))}catch(v){l(v)}}function y(h){try{a(i.throw(h))}catch(v){l(v)}}function a(h){h.done?e(h.value):n(h.value).then(d,y)}a((i=i.apply(o,r||[])).next())})},nt=globalThis&&globalThis.__generator||function(o,r){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,n,e,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(a){return function(h){return y([a,h])}}function y(a){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(e=a[0]&2?n.return:a[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,a[1])).done)return e;switch(n=0,e&&(a=[a[0]&2,e.value]),a[0]){case 0:case 1:e=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,n=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){t.label=a[1];break}if(a[0]===6&&t.label<e[1]){t.label=e[1],e=a;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(a);break}e[2]&&t.ops.pop(),t.trys.pop();continue}a=r.call(o,t)}catch(h){a=[6,h],n=0}finally{i=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},ye=globalThis&&globalThis.__read||function(o,r){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var i=t.call(o),n,e=[],l;try{for(;(r===void 0||r-- >0)&&!(n=i.next()).done;)e.push(n.value)}catch(d){l={error:d}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(l)throw l.error}}return e},ve=globalThis&&globalThis.__spread||function(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(ye(arguments[r]));return o},D=new Map,be=function(){function o(r,t){this.host=r,this.protocol=t}return o.prototype.isFrozen=function(){var r=new Date().getTime(),t=D.get(this.host);return t!=null&&t>=r},o.prototype.freeze=function(r){r===void 0&&(r=20);var t=new Date().getTime()+r*1e3;D.set(this.host,t)},o.prototype.unfreeze=function(){D.delete(this.host)},o.prototype.getUrl=function(){return this.protocol+"://"+this.host},o.prototype.getUnfreezeTime=function(){return D.get(this.host)},o}(),me=function(){function o(r){r===void 0&&(r=[]),this.initHosts=r,this.cachedHostsMap=new Map}return o.prototype.register=function(r,t,i,n){this.cachedHostsMap.set(r+"@"+t,i.map(function(e){return new be(e,n)}))},o.prototype.refresh=function(r,t,i){var n,e,l,d;return rt(this,void 0,void 0,function(){var y,a,h;return nt(this,function(v){switch(v.label){case 0:return y=this.cachedHostsMap.get(r+"@"+t)||[],y.length>0?[2]:this.initHosts.length>0?(this.register(r,t,this.initHosts,i),[2]):[4,Zt(r,t,i)];case 1:return a=v.sent(),(a==null?void 0:a.data)!=null&&(h=ve(((e=(n=a.data.up)===null||n===void 0?void 0:n.acc)===null||e===void 0?void 0:e.main)||[],((d=(l=a.data.up)===null||l===void 0?void 0:l.acc)===null||d===void 0?void 0:d.backup)||[]),this.register(r,t,h,i)),[2]}})})},o.prototype.getUp=function(r,t,i){return rt(this,void 0,void 0,function(){var n,e,l;return nt(this,function(d){switch(d.label){case 0:return[4,this.refresh(r,t,i)];case 1:return d.sent(),n=this.cachedHostsMap.get(r+"@"+t)||[],n.length===0?[2,null]:(e=n.filter(function(y){return!y.isFrozen()}),e.length>0?[2,e[0]]:(l=n.slice().sort(function(y,a){return(y.getUnfreezeTime()||0)-(a.getUnfreezeTime()||0)}),[2,l[0]]))}})})},o}();function we(o,r,t,i){return o.config&&o.config.forceDirect?(i.info("ues forceDirect mode."),new et(o,r,t,i)):o.file.size>4*U?(i.info("file size over 4M, use Resume."),new le(o,r,t,i)):(i.info("file size less or equal than 4M, use Direct."),new et(o,r,t,i))}function _e(o,r,t,i,n){var e=new ge(t,n==null?void 0:n.disableStatisticsReport,n==null?void 0:n.debugLogLevel,o.name),l={file:o,key:r,token:t,putExtra:i,config:Ce(n,e)},d=new me(l.config.uphost);return new kt(function(y){var a=we(l,{onData:function(h){return y.next(h)},onError:function(h){return y.error(h)},onComplete:function(h){return y.complete(h)}},d,e);return a.putFile(),a.stop.bind(a)})}var F=globalThis&&globalThis.__assign||function(){return F=Object.assign||function(o){for(var r,t=1,i=arguments.length;t<i;t++){r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(o[n]=r[n])}return o},F.apply(this,arguments)},xe=globalThis&&globalThis.__rest||function(o,r){var t={};for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&r.indexOf(i)<0&&(t[i]=o[i]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(o);n<i.length;n++)r.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(o,i[n])&&(t[i[n]]=o[i[n]]);return t},Te=globalThis&&globalThis.__read||function(o,r){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var i=t.call(o),n,e=[],l;try{for(;(r===void 0||r-- >0)&&!(n=i.next()).done;)e.push(n.value)}catch(d){l={error:d}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(l)throw l.error}}return e},G=globalThis&&globalThis.__spread||function(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(Te(arguments[r]));return o};function Ce(o,r){var t=F({},o),i=t.upprotocol,n=t.uphost,e=xe(t,["upprotocol","uphost"]),l=F({uphost:[],retryCount:3,checkByMD5:!1,forceDirect:!1,useCdnDomain:!0,checkByServer:!1,concurrentRequestLimit:3,chunkSize:ie,upprotocol:"https",debugLogLevel:"OFF",disableStatisticsReport:!1},e);i&&(l.upprotocol=i.replace(/:$/,""));var d=[];if(r&&(o==null?void 0:o.uphost)!=null&&(o==null?void 0:o.region)!=null&&r.warn("do not use both the uphost and region config."),n)Array.isArray(n)?d.push.apply(d,G(n)):d.push(n);else if(l!=null&&l.region){var y=Nt[l==null?void 0:l.region];l.useCdnDomain?d.push.apply(d,G(y.cdnUphost)):d.push.apply(d,G(y.srcUphost))}return F(F({},l),{uphost:d.filter(Boolean)})}var it=globalThis&&globalThis.__assign||function(){return it=Object.assign||function(o){for(var r,t=1,i=arguments.length;t<i;t++){r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(o[n]=r[n])}return o},it.apply(this,arguments)};globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;var N={PNG:"image/png",JPEG:"image/jpeg",WEBP:"image/webp",BMP:"image/bmp"};Object.keys(N).map(function(o){return N[o]});N.JPEG;async function ke(o,r,t,i){const n=await i.getToken({fileName:r,key:t,file:o,...i.custom});let e=null;return typeof n=="string"?e={token:n,expires:3600}:e=n,e.expiresTime=new Date().getTime()+e.expires*1e3,e.token}async function Se({file:o,fileName:r,onProgress:t,options:i}){const n=await gt(o,r,i),e=await ke(o,r,n,i);return new Promise((l,d)=>{_e(o,n,e,i.putExtra,i.putConfig).subscribe({next(a){a&&t(a.total)},error(a){d(a)},async complete(a){let h={url:i.domain+"/"+n,key:n};if(i.successHandle){h=await i.successHandle(h),l(h);return}l(h)}})})}const Ae={name:"FsUploaderQiniu",setup(){const{proxy:o}=mt(),{getConfig:r}=pt(o),t=r("qiniu");async function i(n){const e=n.options,l=K.merge(K.cloneDeep(t),e);return n.options=l,await Se(n)}return{upload:i}}},Ie={class:"fs-uploader-qiniu"};function Ue(o,r,t,i,n,e){return vt(),bt("span",Ie)}var Pe=yt(Ae,[["render",Ue]]);export{Pe as default};
