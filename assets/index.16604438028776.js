import{G as M,U as I,D as k,A as D}from"./index.16604438028777.js";import{G as L}from"./index.16604438028778.js";import{G as $}from"./index.16604438028775.js";import{b as v,h as S,i as b,j as _,l as C,_ as E,f as B,g as R,E as U}from"./index.1660443802877.js";import{r as c,P as V,aD as A,y as Y,k as N,a1 as d,W as u,T as j,I as G,a8 as h,j as O,$ as F,a0 as P,l as y}from"./vue.1660443802877.js";import{p as q}from"./print.1660443802877.js";function H(){let t=0,o=0;const s={data:c([]),loading:c(!1),dataL:c([]),loadingL:c(!1)},w=C.debounce(async l=>{console.log("fetching material",l),o+=1;const a=o;s.data.value=[],s.loading.value=!0;const n=await(await L({limit:20,page:1,FMaterialId:l})).data;if(console.log("fetching body",n),a!==o)return;const f=n.data.map(e=>({label:`${e.FMaterialId} (${e.FMaterialName})`,text:`${e.FMaterialId} (${e.FMaterialName})`,value:e.id}));s.data.value=f,s.loading.value=!1},800),g=C.debounce(async l=>{console.log("fetching location",l),t+=1;const a=t;s.dataL.value=[],s.loadingL.value=!0;const n=await(await $({limit:20,page:1,binCode:l})).data;if(console.log("fetching body",n),a!==t)return;const f=n.data.map(e=>({label:`${e.binCode} (${e.FStockID})`,text:`${e.binCode} (${e.FStockID})`,value:e.id}));s.dataL.value=f,s.loadingL.value=!1},800);return{fetchMaterial:w,fetchLocation:g,searchState:s}}function z(){const{t}=v(),o=async e=>await M(e),s=async({form:e,row:i})=>(e.id=i.id,await I(e)),w=async({row:e})=>await k(e.id),g=async({form:e})=>await D(e),{fetchMaterial:l,searchState:a,fetchLocation:m}=H(),n=c([]);return{selectedIds:n,crudOptions:{request:{pageRequest:o,addRequest:g,editRequest:s,delRequest:w},primary:{rowKey:"id",onSelectionChange:e=>{console.log("selection",e),n.value=e.map(i=>i.id)}},search:{show:!1},rowHandle:{show:!0},columns:{$checked:{title:"\u9009\u62E9",form:{show:!1},column:{type:"selection",align:"center",width:"55px",columnSetDisabled:!0}},FMaterialId:{title:t("app.warehouse.FMaterialId"),type:"text",form:{show:!1}},FMaterialName:{title:t("app.warehouse.FMaterialName"),type:"text",form:{show:!1}},FModel:{title:t("app.warehouse.FModel"),type:"text",form:{show:!1}},FStockID:{title:t("app.warehouse.FStockID"),type:"text",form:{show:!1}},FLot:{title:t("app.warehouse.FLot"),type:"text",search:{show:!0},form:{}},FStockUnitId:{title:t("app.warehouse.FStockUnitId"),type:"text",form:{value:"PCS"}},FQty:{title:t("app.warehouse.FQty"),type:"text",form:{}},binCode:{title:t("app.warehouse.binCode"),type:"text",form:{show:!1}},FCustomerID:{title:t("app.warehouse.FCustomerID"),type:"text",search:{show:!0},form:{}},pack_sp:{title:t("app.warehouse.pack_sp"),type:"text",search:{show:!0},form:{}},mini_pack:{title:t("app.warehouse.mini_pack"),type:"text",form:{}},expires:{title:t("app.warehouse.expires"),type:"date",search:{show:!0},form:{component:{format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",events:{onChange(e){}}}},valueBuilder({value:e,row:i,key:r}){e!=null&&(i[r]=S(e))}},description:{title:t("app.warehouse.description"),type:"text",form:{}},material:{title:t("app.exit.material"),type:"button",search:{show:!0,component:{style:{width:"240px"}},valueResolve({key:e,value:i,form:r}){i==""&&(r[e]=parseInt("0"))}},column:{show:!1,component:{show:b(({value:e})=>e!=null),on:{onClick({row:e}){_.success(t("app.exit.material")+e.binCode)}}}},form:{component:{name:"fs-dict-select",multiple:!1,filterable:!0,remote:!0,"reserve-keyword":!0,placeholder:t("app.material.FMaterialId"),options:a.data,remoteMethod:e=>{e!==""?l(e):a.data.value=[]},loading:a.loading}}},location:{title:t("app.exit.location"),type:"button",search:{show:!0,component:{style:{width:"240px"}},valueResolve({key:e,value:i,form:r}){i==""&&(r[e]=parseInt("0"))}},column:{show:!1,component:{show:b(({value:e})=>e!=null),on:{onClick({row:e}){_.success(t("app.exit.location")+e.location)}}}},form:{component:{name:"fs-dict-select",multiple:!1,filterable:!0,remote:!0,"reserve-keyword":!0,placeholder:t("app.location.binCode"),options:a.dataL,remoteMethod:e=>{e!==""?m(e):a.dataL.value=[]},loading:a.loadingL}}}}}}}const J=V({name:"primaryWarehouse",setup(){const t=A(),o=c(),s=c(),{t:w}=v(),g=c(w("message.info.uploadURL")),{crudExpose:l}=B({crudRef:o,crudBinding:s}),{crudOptions:a}=z();R({crudExpose:l,crudOptions:a}),Y(()=>{var r,p;if((r=t.query)!=null&&r.id){const x={form:{location:(p=t.query)==null?void 0:p.id}};l.setSearchFormData(x)}l.doRefresh()});const m=()=>{q({printable:"myPrint",type:"html",scanStyles:!0,header:"\u300A\u6253\u5370\u5934-\u53EF\u81EA\u5B9A\u4E49\u300B",style:"@media print{.mb15{margin-bottom:15px;}.el-button--small i.iconfont{font-size: 12px !important;margin-right: 5px;}}"})},n=c(!1);return{crudBinding:s,crudRef:o,dialogVisible:n,handleClose:r=>{U.confirm("Are you sure to close this dialog?").then(()=>{r()}).catch(()=>{})},UploadFile:()=>{n.value=!0},UploadFileSuccess:()=>{l.doRefresh()},onPrintJs:m,uploadURL:g}}}),Q=y("div",{class:"el-upload__text"},[F("\u62D6\u62FD\u6587\u4EF6\u5230\u8FD9\u91CC \u6216\u8005 "),y("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1),T=y("div",{class:"el-upload__tip"},"xls/xlsx files with a size less than 5MB",-1),W={class:"dialog-footer"},K=F("\u53D6 \u6D88"),X=F("\u786E \u5B9A");function Z(t,o,s,w,g,l){const a=h("el-button"),m=h("el-switch"),n=h("fs-crud"),f=h("upload-filled"),e=h("el-icon"),i=h("el-upload"),r=h("el-dialog");return O(),N(G,null,[d(n,j({ref:"crudRef"},t.crudBinding,{id:"myPrint"}),{"actionbar-right":u(()=>[d(a,{type:"success",onClick:t.UploadFile},{default:u(()=>[F(P(t.$t("message.button.import")),1)]),_:1},8,["onClick"]),d(m,{modelValue:t.crudBinding.rowHandle.show,"onUpdate:modelValue":o[0]||(o[0]=p=>t.crudBinding.rowHandle.show=p),"active-color":"#13ce66"},null,8,["modelValue"])]),"footer-top":u(()=>[]),_:1},16),d(r,{modelValue:t.dialogVisible,"onUpdate:modelValue":o[3]||(o[3]=p=>t.dialogVisible=p),title:"\u6839\u636E\u6A21\u677F\u4E0A\u4F20\u6570\u636E",width:"30%","before-close":t.handleClose},{footer:u(()=>[y("span",W,[d(a,{onClick:o[1]||(o[1]=p=>t.dialogVisible=!1)},{default:u(()=>[K]),_:1}),d(a,{type:"primary",onClick:o[2]||(o[2]=p=>t.dialogVisible=!1)},{default:u(()=>[X]),_:1})])]),default:u(()=>[d(i,{class:"upload-demo",drag:"",action:`${t.uploadURL}/api/handler/warehouse/`,"on-success":t.UploadFileSuccess,multiple:""},{tip:u(()=>[T]),default:u(()=>[d(e,{class:"el-icon--upload"},{default:u(()=>[d(f)]),_:1}),Q]),_:1},8,["action","on-success"])]),_:1},8,["modelValue","before-close"])],64)}var ne=E(J,[["render",Z]]);export{ne as default};
