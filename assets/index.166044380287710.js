import{G as M,U as O,D as L,A as Q,E as N,a as U,O as P}from"./ExitInfo.1660443802877.js";import{G}from"./index.16604438028778.js";import{G as _}from"./index.16604438028775.js";import{b as q,e as R,i as S,j as h,l as A,_ as K,v as j,f as J,g as Y}from"./index.1660443802877.js";import{aG as z,r as F,f as T,P as H,y as W,w as Z,t as X,k as ee,a1 as u,W as p,T as te,I as ae,n as oe,a8 as D,j as E,$ as v,a0 as I,l as B,V as le,_ as re}from"./vue.1660443802877.js";import"./index.16604438028777.js";function se(){let t=0,e=0;const i={data:F([]),loading:F(!1),dataL:F([]),loadingL:F(!1)},w=A.debounce(async f=>{console.log("fetching material",f),e+=1;const r=e;i.data.value=[],i.loading.value=!0;const a=await(await G({limit:20,page:1,FMaterialId:f})).data;if(console.log("fetching body",a),r!==e)return;const g=a.data.map(s=>({label:`${s.FMaterialId} (${s.FMaterialName})`,text:`${s.FMaterialId} (${s.FMaterialName})`,value:s.id}));i.data.value=g,i.loading.value=!1},800),m=A.debounce(async f=>{console.log("fetching location",f),t+=1;const r=t;i.dataL.value=[],i.loadingL.value=!0;const a=await(await _({limit:20,page:1,binCode:f})).data;if(console.log("fetching body",a),r!==t)return;const g=a.data.map(s=>({label:`${s.binCode} (${s.FStockID})`,text:`${s.binCode} (${s.FStockID})`,value:s.id}));i.dataL.value=g,i.loadingL.value=!1},800);return{fetchMaterial:w,fetchLocation:m,searchState:i}}function ne({expose:t}){const{t:e}=q();z();const i=async o=>await M(o),w=async({form:o,row:d})=>(o.id=d.id,await O(o)),m=async({row:o})=>await L(o.id),f=async({form:o})=>await Q(o),{fetchMaterial:r,searchState:l,fetchLocation:a}=se(),g=F(!1),s=F(!1),x=T({});return{output:{dialogFormVisible:g,dialogDataVisible:s,curOpts:x},crudOptions:{request:{pageRequest:i,addRequest:f,editRequest:w,delRequest:m},table:{scroll:{x:1400},border:!0,bordered:!0,height:320,size:"small"},rowHandle:{show:!0,fixed:"right",buttons:{edit:{show:!1,text:null,icon:"ion:create-outline",size:"small"},exitBtn:{text:e("message.button.exit_wa"),title:"\u51FA\u5E93\u6309\u94AE",size:"small",order:0,type:"primary",click(o){x.value=o,s.value=!0}}}},columns:{id:{title:"ID",key:"id",type:"number",column:{width:50,show:!1},form:{show:!1}},FBillType:{title:e("app.exit.FBillType"),type:"dict-select",search:{show:!0,rules:null,component:{style:{width:"100px"}}},dict:R({data:[{value:"SAL_OUTSTOCK",label:"\u9500\u552E\u51FA\u5E93\u5355",color:"primary"},{value:"STK_MisDelivery",label:"\u5176\u4ED6\u51FA\u5E93\u5355",color:"warning"},{value:"PUR_MRB",label:"\u91C7\u8D2D\u9000\u6599\u5355",color:"danger"}]}),form:{}},FStockMsg:{title:e("app.exit.FStockMsg"),type:"text",column:{fixed:"left"}},FDate:{title:e("app.exit.FDate"),type:"text",form:{}},FBillNo:{title:e("app.exit.FBillNo"),type:"text",form:{},search:{show:!0,rules:null,component:{style:{width:"100px"}}}},FCustomerID:{title:e("app.exit.FCustomerID"),type:"text",form:{}},exitQty:{title:e("app.exit.exitQty"),type:"text",form:{}},FMaterialMsg:{title:e("app.exit.FMaterialMsg"),type:"text",form:{}},FUnitID:{title:e("app.exit.FUnitID"),type:"text",form:{}},FRealQty:{title:e("app.exit.FRealQty"),type:"text"},FStockID:{title:e("app.exit.FStockID"),type:"text"},FSRCBillNo:{title:e("app.exit.FSRCBillNo"),type:"text"},FARJoinQty:{title:e("app.exit.FARJoinQty"),type:"text"},FARNOTJOINQTY:{title:e("app.exit.FARNOTJOINQTY"),type:"text"},FPrice:{title:e("app.exit.FPrice"),type:"text"},FStockDirect:{title:e("app.exit.FStockDirect"),type:"dict-select",dict:R({data:[{value:"GENERAL",label:"\u666E\u901A",color:"primary"},{value:"RETURN",label:"\u9000\u8D27",color:"danger"}]})},FQty:{title:e("app.exit.FQty"),type:"text"},FAmount:{title:e("app.exit.FAmount"),type:"text"},FSupplierId:{title:e("app.exit.FSupplierId"),type:"text"},FDESCRIPTION:{title:e("app.exit.FDESCRIPTION"),type:"text"},FRMREALQTY:{title:e("app.exit.FRMREALQTY"),type:"text"},FInvoicedStatus:{title:e("app.exit.FInvoicedStatus"),type:"dict-select",dict:R({data:[{value:"A",label:"\u6B63\u5E38",color:"success"},{value:"B",label:"\u5DF2\u7ED3\u675F",color:"danger"}]})},FDocumentStatus:{title:e("app.exit.FDocumentStatus"),type:"dict-select",dict:R({data:[{value:"Z",label:"\u6682\u5B58",color:"warning"},{value:"A",label:"\u521B\u5EFA",color:"info"},{value:"B",label:"\u5BA1\u6838\u4E2D",color:"primary"},{value:"C",label:"\u5DF2\u5BA1\u6838",color:"success"},{value:"D",label:"\u91CD\u65B0\u5BA1\u6838",color:"danger"}]})},material:{title:e("app.exit.material"),type:"button",search:{show:!0,component:{style:{width:"200px"}},valueResolve({key:o,value:d,form:b}){d==""&&(b[o]=parseInt("0"))}},column:{show:!1,component:{show:S(({value:o})=>o!=null),on:{onClick({row:o}){h.success(e("app.exit.material")+o.binCode)}}}},form:{component:{name:"fs-dict-select",multiple:!1,filterable:!0,remote:!0,"reserve-keyword":!0,placeholder:e("app.material.FMaterialId"),options:l.data,remoteMethod:o=>{o!==""?r(o):l.data.value=[]},loading:l.loading}}},location:{title:e("app.exit.location"),type:"button",search:{show:!0,component:{style:{width:"160px"}},valueResolve({key:o,value:d,form:b}){d==""&&(b[o]=parseInt("0"))}},column:{show:!1,component:{show:S(({value:o})=>o!=null),on:{onClick({row:o}){h.success(e("app.exit.location")+o.location)}}}},form:{component:{name:"fs-dict-select",multiple:!1,filterable:!0,remote:!0,"reserve-keyword":!0,placeholder:e("app.location.binCode"),options:l.dataL,remoteMethod:o=>{o!==""?a(o):l.dataL.value=[]},loading:l.loadingL}}}}}}}const ie=H({name:"operateExit",components:{QrStream:j.exports.QrStream,ExitInfo:N},setup(){const t=F(),e=F(),i=F(),w=F(),{crudExpose:m}=J({crudRef:t,crudBinding:w}),{crudOptions:f,output:r}=ne({crudExpose:m});Y({crudExpose:m,crudOptions:f}),W(()=>{m.doRefresh()});const{t:l}=q(),a=T({outData:{},exitData:{},qrData:"",qrDataTip:"PO20220225007,10001000020A,ABC02000JT,PR20220224005,80,1,2022-06-02",camera:"auto",tempData:null,syncLoading:!1,deviceType:"1",qrDataArr:[],barcode:"",realBarcode:"",keyupLastTime:void 0,regexRulePre:/^.+,\d+,\d+,\w{4}-\w{2}-\w{2}/,regexRule:/(\w|[-+*/]|\d)*,(\w|[-+*/]|\d)*,(\w|[-+*/]|\d)*,(\w|[-+*/]|\d)*,\d+,\d+,\w{4}-\w{2}-\w{2}/}),g=async()=>{r.dialogFormVisible.value=!0},s=async()=>{r.dialogFormVisible.value=!1,a.qrData&&await d()},x=async()=>{a.syncLoading=!0,await U({}).then(n=>{const y=n.data;console.log("GetSyncExit",y),y&&y.id?(h({showClose:!0,message:l("message.layout.getSuccess"),center:!0,type:"success"}),m.doRefresh()):h({showClose:!0,message:l("message.layout.getError"),center:!0,type:"error"}),a.syncLoading=!1})},o=async n=>{a.qrData=n,await d()},d=async()=>{if(a.regexRule.test(a.qrData))try{a.qrDataArr=a.qrData.split(","),console.log("\u89E3\u7801\u6210\u529F\uFF1A",a.qrDataArr),h({showClose:!0,message:l("message.info.qrData")+"  "+l("message.success.decode"),center:!0,type:"success"}),a.qrData="",await b()}catch{h({showClose:!0,message:l("message.info.qrData")+"  "+l("message.error.decode"),center:!0,type:"error"})}else console.log("\u6761\u5F62\u7801\u6570\u636E\u683C\u5F0F\u9519\u8BEF\uFF1A",a.qrData),h({showClose:!0,message:l("message.info.qrData")+"  "+l("message.error.format"),center:!0,grouping:!0,type:"error"})},b=async()=>{try{await P({FBillNo:a.qrDataArr[0],FMaterialId:a.qrDataArr[1],FModel:a.qrDataArr[2],FQty:a.qrDataArr[4],FLot:a.qrDataArr[5],expired:a.qrDataArr[6]}).then(n=>{const y=n.data;if(y&&y.MaterialId){const $={form:{material:y.MaterialId}};m.setSearchFormData($),a.exitData=y,h({showClose:!0,message:l("app.exit.material")+" "+l("message.layout.getSuccess"),center:!0,type:"success"}),m.doRefresh(),r.dialogFormVisible.value=!1}else h({showClose:!0,message:l("app.exit.material")+" "+l("message.layout.getError"),center:!0,type:"error"})})}catch(n){console.log("OperateExit",n)}},C=async()=>{const n=r.curOpts.value.row;a.outData=n,e.value.initForm()};Z(()=>[a.deviceType,r.dialogFormVisible.value],()=>{setTimeout(()=>{r.dialogFormVisible.value==!0&&a.deviceType=="2"?a.camera="auto":a.camera="off"},300)});const c=async()=>{console.log("onBlur"),oe(()=>{a.deviceType=="1"&&i.value.focus()})},V=async n=>{try{n.length>12&&a.regexRulePre.test(n)&&n.includes(",")&&(a.qrData=n,await d())}catch(y){console.log("onInput error",y)}},k=async n=>{console.log("preventKeyBord",n.target.value)};return{crudBinding:w,crudRef:t,exitInfoRef:e,...r,ScanQr:g,...X(a),OnDecode:o,SyncExit:x,ScanConfirm:s,DialogData:C,qrDataRef:i,onBlur:c,onInput:V,preventKeyBord:k}}}),ue=v("\u626B\u7801\u67AA"),ce=v("\u6444\u50CF\u5934"),de={class:"result"},pe={class:"dialog-footer"};function me(t,e,i,w,m,f){const r=D("el-button"),l=D("el-switch"),a=D("fs-crud"),g=D("el-radio"),s=D("el-radio-group"),x=D("QrStream"),o=D("el-input"),d=D("el-dialog"),b=D("ExitInfo"),C=D("el-card");return E(),ee(ae,null,[u(a,te({ref:"crudRef"},t.crudBinding),{"actionbar-right":p(()=>[u(r,{type:"warning",onClick:t.SyncExit,loading:t.syncLoading,round:""},{default:p(()=>[v(I(t.$t("message.button.syncKingdee")),1)]),_:1},8,["onClick","loading"]),u(r,{type:"success",onClick:t.ScanQr},{default:p(()=>[v(I(t.$t("message.button.scan")),1)]),_:1},8,["onClick"]),u(l,{modelValue:t.crudBinding.rowHandle.show,"onUpdate:modelValue":e[0]||(e[0]=c=>t.crudBinding.rowHandle.show=c),"active-color":"#13ce66"},null,8,["modelValue"])]),_:1},16),u(d,{modelValue:t.dialogFormVisible,"onUpdate:modelValue":e[5]||(e[5]=c=>t.dialogFormVisible=c),onOpened:t.onBlur},{footer:p(()=>[B("span",pe,[u(r,{onClick:e[4]||(e[4]=c=>t.dialogFormVisible=!1)},{default:p(()=>[v(I(t.$t("message.button.cancel")),1)]),_:1}),u(r,{type:"primary",onClick:t.ScanConfirm},{default:p(()=>[v(I(t.$t("message.button.confirm")),1)]),_:1},8,["onClick"])])]),default:p(()=>[u(s,{modelValue:t.deviceType,"onUpdate:modelValue":e[1]||(e[1]=c=>t.deviceType=c),onChange:e[2]||(e[2]=c=>{(function(){t.deviceType=="1"?(t.qrData="",t.onBlur()):t.deviceType=="2"&&(t.qrData=t.qrDataTip)})()})},{default:p(()=>[u(g,{label:"1",border:""},{default:p(()=>[ue]),_:1}),u(g,{label:"2",border:""},{default:p(()=>[ce]),_:1})]),_:1},8,["modelValue"]),t.deviceType=="2"?(E(),le(x,{key:0,onDecode:t.OnDecode,camera:t.camera},null,8,["onDecode","camera"])):re("",!0),B("div",de,[B("span",null,I(t.$t("app.operateInfo.scanResults"))+":",1),v(" "+I(t.qrData),1)]),u(o,{modelValue:t.qrData,"onUpdate:modelValue":e[3]||(e[3]=c=>t.qrData=c),placeholder:`${t.$t("message.info.qrData")}, ${t.$t("message.info.notice")}: ${t.qrDataTip}`,clearable:"",type:"text",class:"qrcode-text",ref:"qrDataRef",onFocus:t.preventKeyBord,onBlur:t.onBlur,onInput:t.onInput},null,8,["modelValue","placeholder","onFocus","onBlur","onInput"])]),_:1},8,["modelValue","onOpened"]),u(d,{modelValue:t.dialogDataVisible,"onUpdate:modelValue":e[6]||(e[6]=c=>t.dialogDataVisible=c),onOpened:t.DialogData},{default:p(()=>[u(C,{shadow:"hover",header:t.$t("app.operateInfo.exitInfoTitle")},{default:p(()=>[u(b,{ref:"exitInfoRef",exitData:t.exitData,outData:t.outData},null,8,["exitData","outData"])]),_:1},8,["header"])]),_:1},8,["modelValue","onOpened"])],64)}var we=K(ie,[["render",me]]);export{we as default};
