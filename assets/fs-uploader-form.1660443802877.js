import{u as d,b as f}from"./index2.1660443802877.js";import{B as p,l as c}from"./index.1660443802877.js";import{j as i,k as m,g as y}from"./vue.1660443802877.js";function g(t,n,s){let e;s.response?e=`${s.response.error||s.response}`:s.responseText?e=`${s.responseText}`:e=`fail to post ${t} ${s.status}`;const r=new Error(e);return r.status=s.status,r.method="post",r.url=t,r}function w(t){const n=t.responseText||t.response;if(!n)return n;try{return JSON.parse(n)}catch{return n}}function _(t,n,s){if(typeof XMLHttpRequest=="undefined")return;const e=new XMLHttpRequest,r=t.action;e.upload&&(e.upload.onprogress=function(a){a.total>0&&(a.percent=a.loaded/a.total*100),t.onProgress(a)});const l=new FormData;t.data&&Object.keys(t.data).forEach(o=>{l.append(o,t.data[o])}),l.append(t.name,t.file,t.file.name),e.onerror=function(a){s(a)},e.onload=function(){if(e.status<200||e.status>=300)return t.onError(g(r,t,e));n(w(e))},e.open("post",r,!0),t.withCredentials&&"withCredentials"in e&&(e.withCredentials=!0);const u=t.headers||{};for(const o in u)u.hasOwnProperty(o)&&u[o]!==null&&e.setRequestHeader(o,u[o]);return e.send(l),e}function $(t){return new Promise((n,s)=>{_(t,async e=>{n(e)},e=>{s(e)})})}async function k({file:t,fileName:n,onProgress:s,options:e}){var r;const l=await f(t,n,e);e.data==null&&(e.data={}),e.data.key=l;const u={file:t,onProgress:s,...e};delete u.uploadRequest;let a=await((r=e.uploadRequest)!=null?r:$)(u);return e.successHandle&&(a=await e.successHandle(a,u)),a&&typeof a=="object"&&a.key==null&&(a.key=l),a}const q={name:"FsUploaderForm",setup(){const{proxy:t}=y(),{getConfig:n}=d(t),s=n("form");async function e(r){return r.options=c.merge({},c.cloneDeep(s),r.options),await k(r)}return{upload:e}}},R={class:"fs-uploader-form"};function h(t,n,s,e,r,l){return i(),m("span",R)}var E=p(q,[["render",h]]);export{E as default};
